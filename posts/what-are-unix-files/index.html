<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>What are regular Unix files? | José de la Puente | Python and Platform engineering</title>
<meta name="keywords" content="unix">
<meta name="description" content="A primer on regular files and their key characteristics">
<meta name="author" content="">
<link rel="canonical" href="https://josedelapuente.com/posts/what-are-unix-files/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.07bf49839e92734c439e460bc8db0e3fafc1e6322f5523cee1f520bdad544c62.css" integrity="sha256-B79Jg56Sc0xDnkYLyNsOP6/B5jIvVSPO4fUgva1UTGI=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://josedelapuente.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://josedelapuente.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://josedelapuente.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://josedelapuente.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://josedelapuente.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://josedelapuente.com/posts/what-are-unix-files/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:url" content="https://josedelapuente.com/posts/what-are-unix-files/">
  <meta property="og:site_name" content="José de la Puente | Python and Platform engineering">
  <meta property="og:title" content="What are regular Unix files?">
  <meta property="og:description" content="A primer on regular files and their key characteristics">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-12-27T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-12-27T00:00:00+00:00">
    <meta property="article:tag" content="Unix">
      <meta property="og:image" content="https://josedelapuente.com/images/The_Fighting_Temeraire,_JMW_Turner,_National_Gallery.jpg">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://josedelapuente.com/images/The_Fighting_Temeraire,_JMW_Turner,_National_Gallery.jpg">
<meta name="twitter:title" content="What are regular Unix files?">
<meta name="twitter:description" content="A primer on regular files and their key characteristics">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://josedelapuente.com/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "What are regular Unix files?",
      "item": "https://josedelapuente.com/posts/what-are-unix-files/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "What are regular Unix files?",
  "name": "What are regular Unix files?",
  "description": "A primer on regular files and their key characteristics",
  "keywords": [
    "unix"
  ],
  "articleBody": "This is meant to be a brief primer on regular files, which are easy to overlook in their simplicity. This isn’t meant to be exhaustive, and there’s a lot I won’t talk about (inodes!, file descriptors!, POSIX permissioning!).\nRegular files are one of the 7 standard Unix file types:\nFile Type Purpose Common Examples Regular Persistent data storage .txt, .jpg, .mp3 Directory Structuring the file system /home, /etc, /usr Block Buffered access to hardware devices Hard drives (/dev/sda) Character Unbuffered access to hardware devices Terminals (/dev/tty) Pipe Uni-directional inter-process communication Pipes created with mkfifo Socket Bi-directional inter-process communication Network sockets Symbolic link Pointing to another file or directory Files created with ln -s As the table hints at, they serve a crucial purpose: permanent data storage in file systems. As such, I’ll try to convey 3 key characteristics of regular files:\nThey’re unstructured streams of bytes They have random access patterns They allow multiple access Regular files as unstructured streams of bytes on blocks If you take 1 idea from this, it’s that files are streams of bytes with no underlying structure written on blocks.\nFilesystems use “blocks” as the lowest unit of physical storage. Blocks are typically 4KB in size, and files are stored in collections of 1 or more blocks. Thus, each file stores the blocks it uses in its metadata so that when the OS interacts with a file it reads and writes to its blocks.\nThus, the operating system just provides blocks to read to and write from, and you can manipulate its data through fairly flexible system call APIs (e.g. open, read, write). This means that it’s up to the applications opening a file to interpret the bytes of a file and see if the data is as expected or corrupted — which is why corrupted files happen in the first place!\nImages as regular files For example, PNG images have a structured format that specifies how bytes should be structured for the computer to interpret the file (see PNG file format). Yet that doesn’t stop me from being able to create an arbitrary file with .png that doesn’t conform to the format or modify an existing one to corrupt it!\nCode as regular files Another example is that we can all write wrong code, like a .c file with Python code:\n1 print(\"This isn't C!\") I can still save it because the file system allows me to indiscriminately edit the contents of my files (assuming I have the appropriate permissions). However, if I try to compile the C program I’ll get compile-time errors because it doesn’t conform to the C code that the compiler expects.\nPostgres as regular files A good example of this idea are SQL databases like Postgres, which heavily use regular files to store data.\nNaturally, the application logic of Postgres — just like any program — is composed of a group of source code in regular files that are compiled to binary (link to GitHub). In my Unix file system my Postgres binary is in /usr/local/opt/postgresql@14.\nYet it’s not just the source code: the underlying data read and written through Postgres also goes to regular files. Like other databases, Postgres typically stores its data in /var/ directories to signal files that change during the program’s normal operations (mine is in /usr/local/var/postgresql@14). Postgres databases themselves are organized within the /base/ subdirectory, with each subdirectory being named after the object ID (OID) associated with each database in Postgres.\nThis is a simplified tree view of how said directory tree might look like:\n1 2 3 4 5 6 postgresql@14/ ├── base/ # Database files │ ├── 1/ # Database OID │ │ ├── 12345 # Table file │ │ └── 12345_fsm # FSM file ├── ... Where, again, each OID is associated by Postgres to a database name — so there’s a 1-to-1 mapping between them.\nFROM pg_database; oid | datname -------+----------- 14034 | postgres 12345 | template1 14033 | template0 16385 | homework ... For example, if I ls in one of the subdirectories for a database’s files I get a list of files that stores the database’s data:\n1 2 3 4 5 6 7 8 9 ➜ 16385 ls -alh total 17024 drwx------ 296 jadlp admin 9.3K Oct 29 2022 . drwx------ 7 jadlp admin 224B Oct 29 2022 .. -rw------- 1 jadlp admin 8.0K Oct 29 2022 112 -rw------- 1 jadlp admin 8.0K Oct 29 2022 113 -rw------- 1 jadlp admin 112K Oct 29 2022 1247 -rw------- 1 jadlp admin 24K Oct 29 2022 1247_fsm ... And each file is a regular file that can be read from or written to according to its file permissions (note how file 1247 describes the file as data):\n1 2 3 4 ➜ 16385 file 1247 1247: data ➜ 16385 stat 1247 16777224 49754225 -rw------- 1 jadlp admin 0 114688 \"Dec 30 15:34:17 2024\" \"Oct 29 10:08:36 2022\" \"Oct 29 10:08:36 2022\" \"Oct 29 10:08:35 2022\" 4096 224 0 1247 We can even use psql to find that the file 1247 stores the data for pg_type, which is a critical system catalog with Postgres type definitions:\npostgres=# SELECT relname FROM pg_class WHERE oid = 1247; relname --------- pg_type (1 row) So deleting this file would mean the database wouldn’t be able to interpretet the data or run queries! How could it without understanding its data types?\nWe can easily verify this (don’t try this at home!):\n1 ➜ 16385 rm 1247 And then try to use a query with a data type in that database in Postgres.\nhomework=# SELECT 1; 2024-12-30 22:02:44.498 GMT [60150] ERROR: could not open file \"base/16385/1247\": No such file or directory 2024-12-30 22:02:44.498 GMT [60150] STATEMENT: SELECT 1; ERROR: could not open file \"base/16385/1247\": No such file or directory Structured vs unstructured file types: contrasting regular and directory files This feature of the user being able to write any data to regular files doesn’t apply to all file types. For example, you can’t just open a directory file and write to it like a regular file. This is why the below program will output Error occurred: [Errno 21] Is a directory: 'test_dir':\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 import os def try_write_to_directory(): # Create a test directory os.makedirs(\"test_dir\", exist_ok=True) print(\"Created directory: test_dir\") try: # Try to open the directory for writing print(\"\\nAttempting to open directory for writing...\") fd = os.open(\"test_dir\", os.O_WRONLY) # We won't reach this code due to the error print(\"Writing to directory...\") os.write(fd, b\"This shouldn't work\") os.close(fd) except OSError as e: print(f\"Error occurred: {e}\") # Clean up os.rmdir(\"test_dir\") print(\"\\nCleaned up test directory\") if __name__ == \"__main__\": try_write_to_directory() The reason for this is that directories are a structured file format. To protect it, Unix provides APIs that give less control to the user to prevent them from corrupting their file system — unlike regular files, which don’t have those protections. That’s why you can’t use open or write on directories but a more controlled API like opendir and readdir for both safety and convenience.\nRandom access Our Postgres example hinted at another key feature of regular files: random access.\nRandom access means that we can read byte data at any location in the file’s byte stream. This contrasts with sequential access, where we need to read data sequentially — so you can’t just read an arbitrary byte without reading all previous bytes before it. This is why the lseek() system call exists: to offset a byte position when reading from a file.\n1 2 3 f.seek(3) # Move the file pointer to byte 3 of the file `f` f.seek(129) # Move the file pointer to byte 129 of the file print(f.read(1)) # Read 1 byte from position 129 As a contrast to regular files, pipes need to be read sequentially! You can’t just jump at an arbitrary data point in a pipe’s memory.\nMultiple access Multiple access means that multiple processes can have the file connection to read and write to the file. Since regular files handle persistent storage, this is helpful in cases like:\nMultiple services writing to the same log files Multiple database systems reading the same tables Multiple processes reading the same shared config As a corollary, multiple access is why we have concurrency risk and locking mechanisms to address those risks. If you have multiple processes writing to the same file you have a potential race condition that could create inconsistencies.\nAgain, pipes are a contrast: there can only be 1 reader and 1 writer rather than multiple.\nConclusion The key idea I wanted to convey is that our systems run on regular files because persistent storage depends on regular files to store data on the filesystem’s blocks. Files are just some metadata and collections of blocks, where as long as you have permissions you can write anything because applications are responsible for interpreting the data.\nAs I’ll explore in future articles, there’s a need for other file types with different trade-offs than regular files. For starters, there’s other use cases where\nData doesn’t need to persist Access patterns should be sequential rather than random Latency is critical In cases like these, regular files are probably not the best fit because they involve writing to disk. Reading and writing from memory has a much lower latency (100 nanoseconds vs 100K nanoseconds to 2M nanoseconds, depending on the memory device), so that’s a big motivation for other file types with different trade-offs.\n",
  "wordCount" : "1589",
  "inLanguage": "en",
  "image": "https://josedelapuente.com/images/The_Fighting_Temeraire,_JMW_Turner,_National_Gallery.jpg","datePublished": "2024-12-27T00:00:00Z",
  "dateModified": "2024-12-27T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://josedelapuente.com/posts/what-are-unix-files/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "José de la Puente | Python and Platform engineering",
    "logo": {
      "@type": "ImageObject",
      "url": "https://josedelapuente.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://josedelapuente.com/" accesskey="h" title="José de la Puente (Alt + H)">José de la Puente</a>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      What are regular Unix files?
    </h1>
    <div class="post-description">
      A primer on regular files and their key characteristics
    </div>
    <div class="post-meta"><span title='2024-12-27 00:00:00 +0000 UTC'>December 27, 2024</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#regular-files-as-unstructured-streams-of-bytes-on-blocks" aria-label="Regular files as unstructured streams of bytes on blocks">Regular files as unstructured streams of bytes on blocks</a><ul>
                        
                <li>
                    <a href="#images-as-regular-files" aria-label="Images as regular files">Images as regular files</a></li>
                <li>
                    <a href="#code-as-regular-files" aria-label="Code as regular files">Code as regular files</a></li>
                <li>
                    <a href="#postgres-as-regular-files" aria-label="Postgres as regular files">Postgres as regular files</a></li>
                <li>
                    <a href="#structured-vs-unstructured-file-types-contrasting-regular-and-directory-files" aria-label="Structured vs unstructured file types: contrasting regular and directory files">Structured vs unstructured file types: contrasting regular and directory files</a></li></ul>
                </li>
                <li>
                    <a href="#random-access" aria-label="Random access">Random access</a></li>
                <li>
                    <a href="#multiple-access" aria-label="Multiple access">Multiple access</a></li>
                <li>
                    <a href="#conclusion" aria-label="Conclusion">Conclusion</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>This is meant to be a brief primer on regular files, which are easy to overlook in their simplicity. This isn&rsquo;t meant to be exhaustive, and there&rsquo;s a lot I won&rsquo;t talk about (inodes!, file descriptors!, POSIX permissioning!).</p>
<p>Regular files are one of the 7 <a href="https://en.wikipedia.org/wiki/Unix_file_types">standard Unix file types</a>:</p>
<table>
  <thead>
      <tr>
          <th>File Type</th>
          <th>Purpose</th>
          <th>Common Examples</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Regular</td>
          <td>Persistent data storage</td>
          <td><code>.txt</code>, <code>.jpg</code>, <code>.mp3</code></td>
      </tr>
      <tr>
          <td>Directory</td>
          <td>Structuring the file system</td>
          <td><code>/home</code>, <code>/etc</code>, <code>/usr</code></td>
      </tr>
      <tr>
          <td>Block</td>
          <td>Buffered access to hardware devices</td>
          <td>Hard drives (<code>/dev/sda</code>)</td>
      </tr>
      <tr>
          <td>Character</td>
          <td>Unbuffered access to hardware devices</td>
          <td>Terminals (<code>/dev/tty</code>)</td>
      </tr>
      <tr>
          <td>Pipe</td>
          <td>Uni-directional inter-process communication</td>
          <td>Pipes created with <code>mkfifo</code></td>
      </tr>
      <tr>
          <td>Socket</td>
          <td>Bi-directional inter-process communication</td>
          <td>Network sockets</td>
      </tr>
      <tr>
          <td>Symbolic link</td>
          <td>Pointing to another file or directory</td>
          <td>Files created with <code>ln -s</code></td>
      </tr>
  </tbody>
</table>
<p>As the table hints at, they serve a crucial purpose: permanent data storage in file systems. As such, I&rsquo;ll try to convey 3 key characteristics of regular files:</p>
<ul>
<li>They&rsquo;re unstructured streams of bytes</li>
<li>They have random access patterns</li>
<li>They allow multiple access</li>
</ul>
<h2 id="regular-files-as-unstructured-streams-of-bytes-on-blocks">Regular files as unstructured streams of bytes on blocks<a hidden class="anchor" aria-hidden="true" href="#regular-files-as-unstructured-streams-of-bytes-on-blocks">#</a></h2>
<p>If you take 1 idea from this, it&rsquo;s that files are streams of bytes with no underlying structure written on blocks.</p>
<p>Filesystems use &ldquo;blocks&rdquo; as the lowest unit of physical storage. Blocks are typically 4KB in size, and files are stored in collections of 1 or more blocks. Thus, each file stores the blocks it uses in its metadata so that when the OS interacts with a file it reads and writes to its blocks.</p>
<p>Thus, the operating system just provides blocks to read to and write from, and you can manipulate its data through fairly flexible system call APIs (e.g. <code>open</code>, <code>read</code>, <code>write</code>). This means that it&rsquo;s up to the <em>applications</em> opening a file to interpret the bytes of a file and see if the data is as expected or corrupted — which is why corrupted files happen in the first place!</p>
<h3 id="images-as-regular-files">Images as regular files<a hidden class="anchor" aria-hidden="true" href="#images-as-regular-files">#</a></h3>
<p>For example, PNG images have a structured format that specifies how bytes should be structured for the computer to interpret the file (see <a href="https://en.wikipedia.org/wiki/PNG#File_format">PNG file format</a>). Yet that doesn&rsquo;t stop me from being able to create an arbitrary file with <code>.png</code> that doesn&rsquo;t conform to the format or modify an existing one to corrupt it!</p>
<h3 id="code-as-regular-files">Code as regular files<a hidden class="anchor" aria-hidden="true" href="#code-as-regular-files">#</a></h3>
<p>Another example is that we can all write wrong code, like a <code>.c</code> file with Python code:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#a6e22e">print</span>(<span style="color:#e6db74">&#34;This isn&#39;t C!&#34;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>I can still save it because the file system allows me to indiscriminately edit the contents of my files (assuming I have the appropriate permissions). However, if I try to compile the C program I&rsquo;ll get compile-time errors because it doesn&rsquo;t conform to the C code that the compiler expects.</p>
<h3 id="postgres-as-regular-files">Postgres as regular files<a hidden class="anchor" aria-hidden="true" href="#postgres-as-regular-files">#</a></h3>
<p>A good example of this idea are SQL databases like Postgres, which heavily use regular files to store data.</p>
<p>Naturally, the application logic of Postgres — just like any program — is composed of a group of source code in regular files that are compiled to binary (link to <a href="https://github.com/postgres/postgres">GitHub</a>). In my Unix file system my Postgres binary is in <code>/usr/local/opt/postgresql@14</code>.</p>
<p>Yet it&rsquo;s not just the source code: the underlying data read and written through Postgres also goes to regular files. Like other databases, Postgres typically stores its data in <code>/var/</code> directories to signal files that change during the program&rsquo;s normal operations (mine is in <code>/usr/local/var/postgresql@14</code>). Postgres databases themselves are organized within the <code>/base/</code> subdirectory, with each subdirectory being named after the object ID (OID) associated with each database in Postgres.</p>
<p>This is a simplified tree view of how said directory tree might look like:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>postgresql@14/
</span></span><span style="display:flex;"><span>├── base/                  <span style="color:#75715e"># Database files</span>
</span></span><span style="display:flex;"><span>│   ├── 1/                 <span style="color:#75715e"># Database OID</span>
</span></span><span style="display:flex;"><span>│   │   ├── <span style="color:#ae81ff">12345</span>          <span style="color:#75715e"># Table file</span>
</span></span><span style="display:flex;"><span>│   │   └── 12345_fsm      <span style="color:#75715e"># FSM file</span>
</span></span><span style="display:flex;"><span>├── ...
</span></span></code></pre></td></tr></table>
</div>
</div><p>Where, again, each OID is associated by Postgres to a database name — so there&rsquo;s a 1-to-1 mapping between them.</p>
<pre tabindex="0"><code class="language-psql" data-lang="psql">FROM pg_database;
  oid  |  datname
-------+-----------
 14034 | postgres
 12345 | template1
 14033 | template0
 16385 | homework
 ...
</code></pre><p>For example, if I <code>ls</code> in one of the subdirectories for a database&rsquo;s files I get a list of files that stores the database&rsquo;s data:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜  <span style="color:#ae81ff">16385</span> ls -alh
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">17024</span>
</span></span><span style="display:flex;"><span>drwx------  <span style="color:#ae81ff">296</span> jadlp  admin   9.3K Oct <span style="color:#ae81ff">29</span>  <span style="color:#ae81ff">2022</span> .
</span></span><span style="display:flex;"><span>drwx------    <span style="color:#ae81ff">7</span> jadlp  admin   224B Oct <span style="color:#ae81ff">29</span>  <span style="color:#ae81ff">2022</span> ..
</span></span><span style="display:flex;"><span>-rw-------    <span style="color:#ae81ff">1</span> jadlp  admin   8.0K Oct <span style="color:#ae81ff">29</span>  <span style="color:#ae81ff">2022</span> <span style="color:#ae81ff">112</span>
</span></span><span style="display:flex;"><span>-rw-------    <span style="color:#ae81ff">1</span> jadlp  admin   8.0K Oct <span style="color:#ae81ff">29</span>  <span style="color:#ae81ff">2022</span> <span style="color:#ae81ff">113</span>
</span></span><span style="display:flex;"><span>-rw-------    <span style="color:#ae81ff">1</span> jadlp  admin   112K Oct <span style="color:#ae81ff">29</span>  <span style="color:#ae81ff">2022</span> <span style="color:#ae81ff">1247</span>
</span></span><span style="display:flex;"><span>-rw-------    <span style="color:#ae81ff">1</span> jadlp  admin    24K Oct <span style="color:#ae81ff">29</span>  <span style="color:#ae81ff">2022</span> 1247_fsm
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></td></tr></table>
</div>
</div><p>And each file is a regular file that can be read from or written to according to its file permissions (note how <code>file 1247</code> describes the file as <code>data</code>):</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜  <span style="color:#ae81ff">16385</span> file <span style="color:#ae81ff">1247</span>
</span></span><span style="display:flex;"><span>1247: data
</span></span><span style="display:flex;"><span>➜  <span style="color:#ae81ff">16385</span> stat <span style="color:#ae81ff">1247</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">16777224</span> <span style="color:#ae81ff">49754225</span> -rw------- <span style="color:#ae81ff">1</span> jadlp admin <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">114688</span> <span style="color:#e6db74">&#34;Dec 30 15:34:17 2024&#34;</span> <span style="color:#e6db74">&#34;Oct 29 10:08:36 2022&#34;</span> <span style="color:#e6db74">&#34;Oct 29 10:08:36 2022&#34;</span> <span style="color:#e6db74">&#34;Oct 29 10:08:35 2022&#34;</span> <span style="color:#ae81ff">4096</span> <span style="color:#ae81ff">224</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1247</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can even use <code>psql</code> to find that the file <code>1247</code> stores the data for <code>pg_type</code>, which is a critical system catalog with Postgres type definitions:</p>
<pre tabindex="0"><code class="language-psql" data-lang="psql">postgres=# SELECT relname FROM pg_class WHERE oid = 1247;
 relname
---------
 pg_type
(1 row)
</code></pre><p>So deleting this file would mean the database wouldn&rsquo;t be able to interpretet the data or run queries! How could it without understanding its data types?</p>
<p>We can easily verify this (don&rsquo;t try this at home!):</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>➜  <span style="color:#ae81ff">16385</span> rm <span style="color:#ae81ff">1247</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>And then try to use a query with a data type in that database in Postgres.</p>
<pre tabindex="0"><code class="language-psql" data-lang="psql">homework=# SELECT 1;
2024-12-30 22:02:44.498 GMT [60150] ERROR:  could not open file &#34;base/16385/1247&#34;: No such file or directory
2024-12-30 22:02:44.498 GMT [60150] STATEMENT:  SELECT 1;
ERROR:  could not open file &#34;base/16385/1247&#34;: No such file or directory
</code></pre><h3 id="structured-vs-unstructured-file-types-contrasting-regular-and-directory-files">Structured vs unstructured file types: contrasting regular and directory files<a hidden class="anchor" aria-hidden="true" href="#structured-vs-unstructured-file-types-contrasting-regular-and-directory-files">#</a></h3>
<p>This feature of the user being able to write any data to regular files doesn&rsquo;t apply to all file types. For example, you can&rsquo;t just open a directory file and write to it like a regular file. This is why the below program will output <code>Error occurred: [Errno 21] Is a directory: 'test_dir'</code>:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">try_write_to_directory</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Create a test directory</span>
</span></span><span style="display:flex;"><span>    os<span style="color:#f92672">.</span>makedirs(<span style="color:#e6db74">&#34;test_dir&#34;</span>, exist_ok<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Created directory: test_dir&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Try to open the directory for writing</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Attempting to open directory for writing...&#34;</span>)
</span></span><span style="display:flex;"><span>        fd <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>open(<span style="color:#e6db74">&#34;test_dir&#34;</span>, os<span style="color:#f92672">.</span>O_WRONLY)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># We won&#39;t reach this code due to the error</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Writing to directory...&#34;</span>)
</span></span><span style="display:flex;"><span>        os<span style="color:#f92672">.</span>write(fd, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;This shouldn&#39;t work&#34;</span>)
</span></span><span style="display:flex;"><span>        os<span style="color:#f92672">.</span>close(fd)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">OSError</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error occurred: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Clean up</span>
</span></span><span style="display:flex;"><span>    os<span style="color:#f92672">.</span>rmdir(<span style="color:#e6db74">&#34;test_dir&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Cleaned up test directory&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    try_write_to_directory()
</span></span></code></pre></td></tr></table>
</div>
</div><p>The reason for this is that directories are a structured file format. To protect it, Unix provides APIs that give less control to the user to prevent them from corrupting their file system — unlike regular files, which don&rsquo;t have those protections. That&rsquo;s why you can&rsquo;t use <code>open</code> or <code>write</code> on directories but a more controlled API like <code>opendir</code> and <code>readdir</code> for both safety and convenience.</p>
<h2 id="random-access">Random access<a hidden class="anchor" aria-hidden="true" href="#random-access">#</a></h2>
<p>Our Postgres example hinted at another key feature of regular files: random access.</p>
<p>Random access means that we can read byte data at any location in the file&rsquo;s byte stream. This contrasts with sequential access, where we need to read data sequentially — so you can&rsquo;t just read an arbitrary byte without reading all previous bytes before it. This is why the <code>lseek()</code> system call exists: to offset a byte position when reading from a file.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>f<span style="color:#f92672">.</span>seek(<span style="color:#ae81ff">3</span>)        <span style="color:#75715e"># Move the file pointer to byte 3 of the file `f`</span>
</span></span><span style="display:flex;"><span>f<span style="color:#f92672">.</span>seek(<span style="color:#ae81ff">129</span>)      <span style="color:#75715e"># Move the file pointer to byte 129 of the file</span>
</span></span><span style="display:flex;"><span>print(f<span style="color:#f92672">.</span>read(<span style="color:#ae81ff">1</span>)) <span style="color:#75715e"># Read 1 byte from position 129</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>As a contrast to regular files, pipes need to be read sequentially! You can&rsquo;t just jump at an arbitrary data point in a pipe&rsquo;s memory.</p>
<h2 id="multiple-access">Multiple access<a hidden class="anchor" aria-hidden="true" href="#multiple-access">#</a></h2>
<p>Multiple access means that multiple processes can have the file connection to read and write to the file. Since regular files handle persistent storage, this is helpful in cases like:</p>
<ul>
<li>Multiple services writing to the same log files</li>
<li>Multiple database systems reading the same tables</li>
<li>Multiple processes reading the same shared config</li>
</ul>
<p>As a corollary, multiple access is why we have concurrency risk and locking mechanisms to address those risks. If you have multiple processes writing to the same file you have a potential race condition that could create inconsistencies.</p>
<p>Again, pipes are a contrast: there can only be 1 reader and 1 writer rather than multiple.</p>
<h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>The key idea I wanted to convey is that our systems run on regular files because persistent storage <em>depends</em> on regular files to store data on the filesystem&rsquo;s blocks. Files are just some metadata and collections of blocks, where as long as you have permissions you can write anything because applications are responsible for interpreting the data.</p>
<p>As I&rsquo;ll explore in future articles, there&rsquo;s a need for other file types with different trade-offs than regular files. For starters, there&rsquo;s other use cases where</p>
<ul>
<li>Data doesn&rsquo;t need to persist</li>
<li>Access patterns should be sequential rather than random</li>
<li>Latency is critical</li>
</ul>
<p>In cases like these, regular files are probably not the best fit because they involve writing to disk. Reading and writing from memory has a much lower latency (100 nanoseconds vs 100K nanoseconds to 2M nanoseconds, depending on the memory device), so that&rsquo;s a big motivation for other file types with different trade-offs.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://josedelapuente.com/tags/unix/">Unix</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
</body>

</html>
